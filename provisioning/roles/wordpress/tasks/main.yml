---
# TODO: clean this up.
- name: Installing WP-CLI
  get_url:
    url: https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
    dest: /usr/bin/wp
    mode: 0755

# Create empty wordpress database (wp-cli gives you more options with the DB there)
- mysql_db:
    name: '{{ project_name }}'
    state: present
    login_user: vagrant
    login_password: vagrant

- name: Test whether Wordpress is present.
  stat: path="{{ wordpress_docroot }}/wp-config.php"
  register: wordpress_present

- name: Downloading Wordpress
  shell: "sudo -u vagrant -i -- wp core download --path={{ wordpress_docroot }}"
  when: not wordpress_present.stat.exists

- name: Configuring Wordpress
  shell: "sudo -u vagrant -i -- wp core config --dbname={{ project_name }} --dbuser=vagrant --dbpass=vagrant --path={{ wordpress_docroot }}"
  when: not wordpress_present.stat.exists

- name: Installing Wordpress
  shell: "sudo -u vagrant -i -- wp core install --url=\"http://{{ project_hostname }}\" --title=\"{{ wordpress_sitename }}\" --admin_user=\"{{ wordpress_admin_user }}\" --admin_password=\"{{ wordpress_admin_pass }}\" --admin_email=\"{{ wordpress_admin_email }}\" --path={{ wordpress_docroot }}"

#- name: Additional Wordpress provisioning
  #shell: "sudo -u vagrant -i -- wp rewrite structure \"/%postname%/\" --path={{ wordpress_docroot }}"
  #shell: "sudo -u vagrant -i -- wp plugin install http://downloads.wordpress.org/plugin/relative-url.zip --activate --path={{ wordpress_docroot }}"
  #shell: "sudo -u vagrant -i -- wp plugin install http://downloads.wordpress.org/plugin/w3-total-cache.zip --activate --path={{ wordpress_docroot }}"
  #shell: "sudo -u vagrant -i -- wp theme install twentyfifteen --activate
